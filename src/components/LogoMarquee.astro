---
interface Props {
  class?: string;
}

const { class: className = '' } = Astro.props;

// Company logos - companies where our team has built orgs and AI
// height: per-logo sizing for visual balance (default h-10)
// width: per-logo width for proper aspect ratio display
const logos = [
  { name: 'Cisco', src: '/images/logos/cisco.svg', height: 'h-12', width: 'w-24' },
  { name: 'Twilio', src: '/images/logos/twilio.svg', height: 'h-12', width: 'w-40' },
  { name: 'Uber', src: '/images/logos/uber.svg', width: 'w-28' },
  { name: 'Indeed', src: '/images/logos/indeed.svg', width: 'w-36' },
  { name: 'Berkeley SkyDeck', src: '/images/logos/berkeley-skydeck.svg', height: 'h-8', width: 'w-[365px]' },
  { name: 'RetailMeNot', src: '/images/logos/retailmenot.svg', width: 'w-56' },
  { name: 'ComPsych', src: '/images/logos/compsych.svg', width: 'w-56' },
  { name: 'Adept', src: '/images/logos/adept.svg', width: 'w-60' },
];
---

<section class:list={['logo-marquee-section py-16 overflow-hidden', className]}>
  <div class="max-w-4xl mx-auto px-6 mb-8">
    <p class="text-center text-sm text-muted-foreground uppercase tracking-wider">
      Companies where our team has built orgs and AI
    </p>
  </div>

  <div class="logo-marquee-container relative">
    <!-- Fade edges -->
    <div class="fade-edge-left absolute left-0 top-0 bottom-0 w-24 z-10 pointer-events-none" />
    <div class="fade-edge-right absolute right-0 top-0 bottom-0 w-24 z-10 pointer-events-none" />

    <!-- Scrolling track - each set wrapped with trailing padding for seamless 50% loop -->
    <div class="logo-marquee-track flex">
      {/* First set of logos */}
      <div class="logo-set flex items-center gap-16 pr-16">
        {logos.map((logo) => (
          <div class:list={["logo-item flex-shrink-0 flex items-center justify-center", logo.height || 'h-10']}>
            <div class:list={["logo-mask h-full opacity-50 hover:opacity-80 transition-opacity", logo.width || 'w-28']} style={`-webkit-mask-image: url(${logo.src}); mask-image: url(${logo.src});`} role="img" aria-label={logo.name}></div>
          </div>
        ))}
      </div>
      {/* Duplicate for seamless loop */}
      <div class="logo-set flex items-center gap-16 pr-16" aria-hidden="true">
        {logos.map((logo) => (
          <div class:list={["logo-item flex-shrink-0 flex items-center justify-center", logo.height || 'h-10']}>
            <div class:list={["logo-mask h-full opacity-50 hover:opacity-80 transition-opacity", logo.width || 'w-28']} style={`-webkit-mask-image: url(${logo.src}); mask-image: url(${logo.src});`}></div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  /* Section background - use exact same oklch as --background in global.css */
  .logo-marquee-section {
    background-color: oklch(0.985 0.008 85);
    /* Isolate this section to prevent repaint interactions with page */
    isolation: isolate;
    contain: layout style paint;
  }

  .logo-marquee-container {
    /* Force GPU layer for the container */
    transform: translateZ(0);
  }

  :global(.dark) .logo-marquee-section {
    background-color: oklch(0.18 0.015 50);
  }

  /*
   * Animation duration: consistent ~60-70 px/s across all viewports.
   * 2077px / 32s = 65 px/s
   */
  .logo-marquee-track {
    animation: marquee 32s linear infinite;
  }

  .logo-marquee-container:hover .logo-marquee-track {
    animation-play-state: paused;
  }

  /* GPU acceleration for smooth animation */
  .logo-marquee-track {
    will-change: transform;
    backface-visibility: hidden;
  }

  @keyframes marquee {
    0% {
      transform: translate3d(0, 0, 0);
    }
    100% {
      transform: translate3d(-2077px, 0, 0);
    }
  }

  /* Fade edges - interpolate in oklch to same color with 0 alpha */
  .fade-edge-left {
    background: linear-gradient(in oklch to right, oklch(0.985 0.008 85), oklch(0.985 0.008 85 / 0));
  }

  .fade-edge-right {
    background: linear-gradient(in oklch to left, oklch(0.985 0.008 85), oklch(0.985 0.008 85 / 0));
  }

  :global(.dark) .fade-edge-left {
    background: linear-gradient(in oklch to right, oklch(0.18 0.015 50), oklch(0.18 0.015 50 / 0));
  }

  :global(.dark) .fade-edge-right {
    background: linear-gradient(in oklch to left, oklch(0.18 0.015 50), oklch(0.18 0.015 50 / 0));
  }

  /* Logo colors using mask technique */
  .logo-mask {
    /* Light mode: bright golden sun color ~oklch(0.80 0.18 80) */
    background-color: #D4A030;
    -webkit-mask-size: contain;
    mask-size: contain;
    -webkit-mask-repeat: no-repeat;
    mask-repeat: no-repeat;
    -webkit-mask-position: center;
    mask-position: center;
  }

  :global(.dark) .logo-mask {
    /* Dark mode: deeper golden ~oklch(0.65 0.15 80) */
    background-color: #B08020;
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .logo-marquee-track {
      animation: none;
    }
  }
</style>
