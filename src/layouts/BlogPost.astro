---
import BaseLayout from './BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  subtitle?: string;
  description: string;
  publishedDate: Date;
  modifiedDate?: Date;
  author: {
    name: string;
    email?: string;
    role?: string;
  };
  coAuthors?: Array<{
    name: string;
    email?: string;
    role?: string;
  }>;
  tags?: string[];
}

const {
  title,
  subtitle,
  description,
  publishedDate,
  modifiedDate,
  author,
  coAuthors,
  tags,
} = Astro.props;

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

const allAuthors = [author, ...(coAuthors || [])];
---

<BaseLayout
  title={title}
  description={description}
  ogType="article"
  publishedTime={publishedDate.toISOString()}
  modifiedTime={modifiedDate?.toISOString()}
>
  <Nav />
  
  <main class="pt-24">
    <article class="max-w-3xl mx-auto px-6 py-12">
      <!-- Header -->
      <header class="mb-12">
        <div class="flex items-center gap-2 text-sm text-muted-foreground mb-4">
          <a href="/blog" class="hover:text-foreground transition-colors">Blog</a>
          <span>/</span>
          <time datetime={publishedDate.toISOString()}>
            {formatDate(publishedDate)}
          </time>
          {modifiedDate && modifiedDate > publishedDate && (
            <>
              <span class="text-muted-foreground/50">â€¢</span>
              <span>Updated {formatDate(modifiedDate)}</span>
            </>
          )}
        </div>
        
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold tracking-tight text-foreground mb-6">
          {title}
        </h1>
        
        <p class="text-xl text-muted-foreground leading-relaxed mb-6">
          {subtitle || description}
        </p>
        
        <div class="flex flex-wrap items-center gap-4 text-sm">
          {allAuthors.map((a, i) => (
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-medium">
                {a.name.charAt(0)}
              </div>
              <div>
                <div class="font-medium text-foreground">{a.name}</div>
                {a.role && <div class="text-muted-foreground text-xs">{a.role}</div>}
              </div>
            </div>
          ))}
        </div>
        
        {tags && tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mt-6">
            {tags.map((tag) => (
              <span class="px-3 py-1 text-xs font-medium rounded-full bg-muted text-muted-foreground">
                {tag}
              </span>
            ))}
          </div>
        )}
      </header>
      
      <!-- Content -->
      <div class="prose prose-lg max-w-none prose-headings:font-semibold prose-headings:tracking-tight prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-blockquote:border-l-primary prose-blockquote:not-italic prose-blockquote:text-muted-foreground">
        <slot />
      </div>
      
      <!-- Footer -->
      <footer class="mt-16 pt-8 border-t border-border">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
          <div>
            <p class="text-sm text-muted-foreground">
              Need a step change in coding productivity and quality?
            </p>
          </div>
          <a 
            href="mailto:hello@rae.partners" 
            class="inline-flex items-center justify-center px-4 py-2 text-sm font-medium rounded-md bg-primary text-primary-foreground hover:bg-primary/90 transition-colors"
          >
            Get in touch
          </a>
        </div>
      </footer>
    </article>
  </main>
  
  <Footer />
</BaseLayout>

<style is:global>
  /* Prose typography customizations */
  .prose {
    --tw-prose-body: var(--foreground);
    --tw-prose-headings: var(--foreground);
    --tw-prose-links: var(--primary);
    --tw-prose-bold: var(--foreground);
    --tw-prose-counters: var(--muted-foreground);
    --tw-prose-bullets: var(--primary);
    --tw-prose-hr: var(--border);
    --tw-prose-quotes: var(--foreground);
    --tw-prose-quote-borders: var(--primary);
    --tw-prose-captions: var(--muted-foreground);
    --tw-prose-code: var(--foreground);
    --tw-prose-pre-code: var(--foreground);
    --tw-prose-pre-bg: var(--muted);
  }

  /* Generous spacing for readability */
  .prose > * + * {
    margin-top: 1.75em;
  }

  /* Section headings - visually distinct with accent color */
  .prose h2 {
    margin-top: 3em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    border-bottom: 2px solid var(--primary);
    color: var(--foreground);
    font-size: 1.5em;
    letter-spacing: -0.02em;
  }

  /* Subheadings - smaller, no border */
  .prose h3 {
    margin-top: 1.5em;
    margin-bottom: 0.75em;
    font-size: 1.1em;
    color: var(--muted-foreground);
    font-weight: 500;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  /* Blockquotes - larger, more prominent */
  .prose blockquote {
    font-size: 1.25em;
    line-height: 1.6;
    padding: 1.5em 2em;
    margin: 2.5em 0;
    background: oklch(0.97 0.008 85);
    border-left: 4px solid var(--primary);
    border-radius: 0 0.5em 0.5em 0;
  }

  .dark .prose blockquote {
    background: oklch(0.24 0.015 50);
  }

  .prose blockquote p {
    margin: 0;
  }

  .prose blockquote p + p {
    margin-top: 0.75em;
  }

  /* Strikethrough styling - opacity 0.75 maintains WCAG AA contrast */
  .prose del,
  .prose s {
    text-decoration: line-through;
    opacity: 0.75;
  }

  /* Horizontal rules as section dividers */
  .prose hr {
    margin: 3em 0;
    border: none;
    height: 1px;
    background: linear-gradient(
      to right,
      transparent,
      var(--border) 20%,
      var(--border) 80%,
      transparent
    );
  }

  /* Lists with better spacing and styling */
  .prose ul {
    margin: 2em 0;
    padding-left: 0;
    list-style: none;
  }

  .prose ul li {
    position: relative;
    padding-left: 2em;
    margin-bottom: 0.75em;
  }

  .prose ul li::before {
    content: "";
    position: absolute;
    left: 0.5em;
    top: 0.6em;
    width: 6px;
    height: 6px;
    background: var(--primary);
    border-radius: 50%;
  }

  /* Bold text emphasis - more prominent in dark mode */
  .prose strong {
    font-weight: 700;
    color: var(--foreground);
  }

  .dark .prose strong {
    color: oklch(0.95 0.02 80);
  }

  /* Paragraphs */
  .prose p {
    line-height: 1.8;
  }

  /* First paragraph after heading - no extra top margin */
  .prose h2 + p,
  .prose h3 + p {
    margin-top: 0;
  }

  /* Links - visible and interactive */
  .prose a {
    color: var(--primary);
    text-decoration: underline;
    text-decoration-color: var(--primary);
    text-underline-offset: 3px;
    text-decoration-thickness: 1px;
    transition: text-decoration-color 0.15s ease;
  }

  .prose a:hover {
    text-decoration-thickness: 2px;
  }

  .dark .prose a {
    color: oklch(0.80 0.16 80);
    text-decoration-color: oklch(0.80 0.16 80);
  }
</style>
